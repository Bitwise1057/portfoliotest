<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gallery</title>
  <link rel="icon" type="image/png" href="img/icon.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <script>
    if (
      localStorage.theme === 'dark' ||
      (!('theme' in localStorage) &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  </script>
</head>
<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white transition-colors relative">
  <!-- Header with nav + theme toggle -->
  <header class="bg-gray-100 dark:bg-gray-800 shadow relative">
    <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <!-- Navigation -->
      <nav class="flex justify-center gap-4 flex-wrap">
        <a href="index.html" class="px-4 py-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition text-sm sm:text-base">Home</a>
        <a href="gallery.html" class="px-4 py-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition text-sm sm:text-base">Gallery</a>
        <a href="about.html" class="px-4 py-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition text-sm sm:text-base">About</a>
      </nav>
      <!-- Theme toggle -->
        <button onclick="toggleTheme()" class="fixed top-4 right-4 z-50 px-3 py-1 border rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition text-sm" aria-label="Toggle dark mode">Theme Toggle</button>
    </div>
  </header>

  <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Main Content -->
    <main class="flex-grow py-10">
      <section>
        <h1 class="text-xl sm:text-2xl font-semibold mb-6 text-center">Character Art</h1>

        <!-- Gallery Container -->
        <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6" aria-label="Char Art Gallery">
          <!-- Populated by JSON -->
        </div>
      </section>
    </main>
  </div>
  <!-- Footer -->
<footer class="bg-gray-100 dark:bg-gray-800 shadow text-center text-xs sm:text-sm text-gray-500 py-6 fixed bottom-0 left-0 w-full">
  Â© 2025 Example
</footer>



  <!-- Lightbox Overlay -->
  <div id="overlay" 
       class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50"
       onclick="overlayClick(event)">
    <!-- Close button -->
    <span class="absolute top-4 right-6 text-white text-3xl font-bold cursor-pointer select-none" onclick="closeImage()">&times;</span>

    <!-- Image + caption -->
    <div class="relative max-w-5xl w-full px-4" onclick="event.stopPropagation()">
      <div class="flex items-center justify-between">
        <!-- Prev button -->
        <button id="prevBtn" 
                class="text-white text-4xl font-bold px-4 py-2 bg-black bg-opacity-30 rounded-l hover:bg-opacity-50 transition select-none"
                onclick="changeImage(-1)">&#10094;</button>

        <!-- Enlarged Image -->
        <img id="overlay-img" src="" alt="Enlarged view" class="w-full h-auto rounded shadow-lg mx-auto">

        <!-- Next button -->
        <button id="nextBtn" 
                class="text-white text-4xl font-bold px-4 py-2 bg-black bg-opacity-30 rounded-r hover:bg-opacity-50 transition select-none"
                onclick="changeImage(1)">&#10095;</button>
      </div>

      <!-- Caption -->
      <p id="overlay-caption" class="text-center text-gray-200 mt-4 text-xl sm:text-2xl md:text-3xl"></p>
    </div>
  </div>

  <script>
    function toggleTheme() {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.theme = isDark ? 'dark' : 'light';
    }

    const overlay = document.getElementById('overlay');
    const overlayImg = document.getElementById('overlay-img');
    const overlayCaption = document.getElementById('overlay-caption');
    let currentIndex = 0;
    let galleryData = [];

  async function loadGallery() {
    const gallery = document.getElementById('gallery');

try {
  const res = await fetch('gallery.json');
  if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);

  galleryData = await res.json(); // use global galleryData
  gallery.innerHTML = '';

  galleryData.forEach((item, index) => {
    const figure = document.createElement('figure');
    figure.className = "bg-gray-100 dark:bg-gray-800 rounded shadow overflow-hidden flex flex-col";

    const img = document.createElement('img');
    img.src = item.src;
    img.alt = item.alt || item.caption;
    img.className = "w-full h-64 object-cover transition-transform duration-300 hover:scale-105 cursor-pointer";
    img.loading = "lazy";

    const caption = document.createElement('figcaption');
    caption.className = "p-2 text-center text-sm sm:text-base bg-gray-50 dark:bg-gray-700";
    caption.textContent = item.caption;

    // Image-level error handling
    img.onerror = () => {
      img.src = 'img/stein.png'; // fallback image
      img.alt = 'Image not available';
      caption.textContent = 'Image failed to load';
    };

    img.addEventListener('click', () => openImage(index));

    figure.appendChild(img);
    figure.appendChild(caption);
    gallery.appendChild(figure);
  });
} catch (e) {
  gallery.innerHTML = `
    <div class="col-span-full flex items-center justify-center py-20">
      <div class="p-6 text-center text-red-600 bg-red-100 dark:bg-red-900 rounded shadow">
        <strong class="block mb-2">Failed to load gallery</strong>
        <span class="block text-sm">${e.message}</span>
      </div>
    </div>
  `;
}

// Overlay-safe handling
function updateOverlay() {
  const data = galleryData[currentIndex];
  const galleryImg = gallery.children[currentIndex]?.querySelector('img');
  if (!data || !data.src || (galleryImg && galleryImg.naturalWidth === 0)) {
    overlayImg.src = 'img/stein.png';
    overlayCaption.innerText = 'Image not available';
    return;
  }
  overlayImg.src = data.src;
  overlayCaption.innerText = data.caption;
}

  }

    function openImage(index) {
      currentIndex = index;
      updateOverlay();
      overlay.classList.remove('hidden');
      updateOverlay();
    }

    function updateOverlay() {
      const data = galleryData[currentIndex];
      overlayImg.src = data.src;
      overlayCaption.innerText = data.caption; // caption from JSON
    }

    function closeImage() {
      overlay.classList.add('hidden');
    }

    function changeImage(direction) {
      currentIndex = (currentIndex + direction + galleryData.length) % galleryData.length;
      updateOverlay();
    }

    function overlayClick(event) {
      if (event.target.id === 'overlay') {
        closeImage();
      }
    }

    document.addEventListener('keydown', (e) => {
      if (overlay.classList.contains('hidden')) return;
      if (e.key === 'Escape') closeImage();
      if (e.key === 'ArrowRight') changeImage(1);
      if (e.key === 'ArrowLeft') changeImage(-1);
    });

    document.addEventListener('DOMContentLoaded', loadGallery);
  </script>
</body>
</html>
